

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>6. A simple GUI app</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/sidebar.js"></script>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="top" title="None" href="../index.html" />
    <link rel="up" title="Tutorials" href="index.html" />
    <link rel="next" title="Guides" href="../guides/index.html" />
    <link rel="prev" title="5. A simple command line app" href="cli-app.html" />
    <link rel="shortcut icon" type="image/png" href="../_static/lantz16.png" />
 

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../guides/index.html" title="Guides"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="cli-app.html" title="5. A simple command line app"
             accesskey="P">previous</a> |</li>
        <li><img src="../_static/lantz16.png" alt=""
                 style="vertical-align: middle; margin-top: -1px"/></li>
        <li><a href="../index.html">Lantz</a> &raquo;</li>

          <li><a href="index.html" accesskey="U">Tutorials</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="a-simple-gui-app">
<span id="tutorial-gui-app"></span><h1>6. A simple GUI app<a class="headerlink" href="#a-simple-gui-app" title="Permalink to this headline">Â¶</a></h1>
<p>In this part of the tutorial you will build an application to do a frequency
scan like in the previous tutorial (<a class="reference internal" href="cli-app.html#tutorial-cli-app"><em>A simple command line app</em></a>) but with a
graphical frontend.</p>
<p>Start the simulated instrument running the following command:</p>
<div class="highlight-python"><pre>$ lantz-sim fungen tcp</pre>
</div>
<p>Using Qt Designer, create a window like this:</p>
<img alt="Scan frequency window." src="../_images/gui-app.png" />
<p>and save it as <cite>scanfrequency.ui</cite> in the folder in which you have created
the driver (<a class="reference internal" href="building.html#tutorial-building"><em>Building your own drivers</em></a>). For the example, we have labeled
each control as corresponding label in lower caps (amplitude, offset,
waveform, start, stop, step, wait). The button is named <cite>scan</cite>.
You can also download
<a class="reference download internal" href="../_downloads/scanfrequency.ui"><tt class="xref download docutils literal"><span class="pre">the</span> <span class="pre">ui</span> <span class="pre">file</span></tt></a> if you prefer.</p>
<p>Notice that the <cite>amplitude</cite> and <cite>offset</cite> don&#8217;t show units and that the <cite>waveform</cite>
combobox is not populated. These widgets will be connected to the corresponding
Feats of the drivers and Lantz will take care of setting the right values, items,
etc.</p>
<p>Create a python file named <cite>scanfrequency-gui.py</cite> with the following content:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">sys</span>

<span class="c"># Import lantz.ui register an import hook that will replace calls to Qt by PyQt4 or PySide ...</span>
<span class="kn">import</span> <span class="nn">lantz.ui</span>

<span class="c"># and here we just use Qt and will work with both bindings!</span>
<span class="kn">from</span> <span class="nn">Qt.QtGui</span> <span class="kn">import</span> <span class="n">QApplication</span><span class="p">,</span> <span class="n">QWidget</span>
<span class="kn">from</span> <span class="nn">Qt.uic</span> <span class="kn">import</span> <span class="n">loadUi</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">QApplication</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>

<span class="c"># Load the UI from the QtDesigner file. You can also use pyuic4 to generate a class.</span>
<span class="n">main</span> <span class="o">=</span> <span class="n">loadUi</span><span class="p">(</span><span class="s">&#39;scanfrequency.ui&#39;</span><span class="p">)</span>

<span class="c"># Start the app</span>
<span class="n">main</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="nb">exit</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">exec_</span><span class="p">())</span>
</pre></div>
</div>
<p>Run this stub should display the window:</p>
<div class="highlight-python"><pre>$ python scanfrequency-gui.py</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In Windows, you can use <cite>pythonw</cite> instead of <cite>python</cite> to suppress the
terminal window.</p>
</div>
<p>We will now add the code to do the actual frequency scan. We will reuse the
function from the last tutorial:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">sys</span>

<span class="c"># Import lantz.ui register an import hook that will replace calls to Qt by PyQt4 or PySide ...</span>
<span class="kn">import</span> <span class="nn">lantz.ui</span>
<span class="kn">from</span> <span class="nn">lantz</span> <span class="kn">import</span> <span class="n">Q_</span>

<span class="c"># and here we just use Qt and will work with both bindings!</span>
<span class="kn">from</span> <span class="nn">Qt.QtGui</span> <span class="kn">import</span> <span class="n">QApplication</span><span class="p">,</span> <span class="n">QWidget</span>
<span class="kn">from</span> <span class="nn">Qt.uic</span> <span class="kn">import</span> <span class="n">loadUi</span>

<span class="c"># These imports are from your own project</span>
<span class="kn">from</span> <span class="nn">mydriver</span> <span class="kn">import</span> <span class="n">LantzSignalGeneratorTCP</span>
<span class="kn">from</span> <span class="nn">scanfrequency</span> <span class="kn">import</span> <span class="n">scan_frequency</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">QApplication</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>

<span class="c"># Load the UI from the QtDesigner file. You can also use pyuic4 to generate a class.</span>
<span class="n">main</span> <span class="o">=</span> <span class="n">loadUi</span><span class="p">(</span><span class="s">&#39;scanfrequency.ui&#39;</span><span class="p">)</span>

<span class="n">Hz</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;Hz&#39;</span><span class="p">)</span>
<span class="n">sec</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;second&#39;</span><span class="p">)</span>

<span class="k">with</span> <span class="n">LantzSignalGeneratorTCP</span><span class="p">(</span><span class="s">&#39;localhost&#39;</span><span class="p">,</span> <span class="mi">5678</span><span class="p">)</span> <span class="k">as</span> <span class="n">inst</span><span class="p">:</span>

    <span class="c"># Obtain a reference to the widgets controlling the scan parameters</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">main</span><span class="o">.</span><span class="n">findChild</span><span class="p">((</span><span class="n">QWidget</span><span class="p">,</span> <span class="p">),</span> <span class="s">&#39;start&#39;</span><span class="p">)</span>
    <span class="n">stop</span> <span class="o">=</span> <span class="n">main</span><span class="o">.</span><span class="n">findChild</span><span class="p">((</span><span class="n">QWidget</span><span class="p">,</span> <span class="p">),</span> <span class="s">&#39;stop&#39;</span><span class="p">)</span>
    <span class="n">step</span> <span class="o">=</span> <span class="n">main</span><span class="o">.</span><span class="n">findChild</span><span class="p">((</span><span class="n">QWidget</span><span class="p">,</span> <span class="p">),</span> <span class="s">&#39;step&#39;</span><span class="p">)</span>
    <span class="n">wait</span> <span class="o">=</span> <span class="n">main</span><span class="o">.</span><span class="n">findChild</span><span class="p">((</span><span class="n">QWidget</span><span class="p">,</span> <span class="p">),</span> <span class="s">&#39;wait&#39;</span><span class="p">)</span>
    <span class="n">scan</span> <span class="o">=</span> <span class="n">main</span><span class="o">.</span><span class="n">findChild</span><span class="p">((</span><span class="n">QWidget</span><span class="p">,</span> <span class="p">),</span> <span class="s">&#39;scan&#39;</span><span class="p">)</span>

    <span class="c"># Define a function to read the values from the widget and call scan_frequency</span>
    <span class="k">def</span> <span class="nf">scan_clicked</span><span class="p">():</span>
        <span class="n">scan_frequency</span><span class="p">(</span><span class="n">inst</span><span class="p">,</span> <span class="n">start</span><span class="o">.</span><span class="n">value</span><span class="p">()</span> <span class="o">*</span> <span class="n">Hz</span><span class="p">,</span> <span class="n">stop</span><span class="o">.</span><span class="n">value</span><span class="p">()</span> <span class="o">*</span> <span class="n">Hz</span><span class="p">,</span>
                       <span class="n">step</span><span class="o">.</span><span class="n">value</span><span class="p">()</span> <span class="o">*</span> <span class="n">Hz</span><span class="p">,</span> <span class="n">wait</span><span class="o">.</span><span class="n">value</span><span class="p">()</span> <span class="o">*</span> <span class="n">sec</span><span class="p">)</span>

    <span class="c"># Connect the clicked signal of the scan button to the function</span>
    <span class="n">scan</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">scan_clicked</span><span class="p">)</span>

    <span class="c"># Scan the app</span>
    <span class="n">main</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="nb">exit</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">exec_</span><span class="p">())</span>
</pre></div>
</div>
<p>When the button is clicked, Qt will emit a signal which is connected to the
function we have defined the application should scan the frequency. You will
not see anything happening in the Window, but if you look in the simulator
console you will see the frequency changing.</p>
<div class="section" id="connecting-widgets-to-feats">
<h2>6.1. Connecting widgets to Feats<a class="headerlink" href="#connecting-widgets-to-feats" title="Permalink to this headline">Â¶</a></h2>
<p>To allow the user to change the amplitude, offset, shape and frequency, we will
connect the configuration widgets:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">sys</span>

<span class="c"># Import lantz.ui register an import hook that will replace calls to Qt by PyQt4 or PySide ...</span>
<span class="kn">import</span> <span class="nn">lantz.ui</span>
<span class="kn">from</span> <span class="nn">lantz</span> <span class="kn">import</span> <span class="n">Q_</span>

<span class="c"># and here we just use Qt and will work with both bindings!</span>
<span class="kn">from</span> <span class="nn">Qt.QtGui</span> <span class="kn">import</span> <span class="n">QApplication</span><span class="p">,</span> <span class="n">QWidget</span>
<span class="kn">from</span> <span class="nn">Qt.uic</span> <span class="kn">import</span> <span class="n">loadUi</span>

<span class="c"># Import from lantz a function to connect drivers to UI &lt;--- NEW</span>
<span class="kn">from</span> <span class="nn">lantz.ui.qtwidgets</span> <span class="kn">import</span> <span class="n">connect_driver</span>

<span class="c"># These imports are from your own project</span>
<span class="kn">from</span> <span class="nn">mydriver</span> <span class="kn">import</span> <span class="n">LantzSignalGeneratorTCP</span>
<span class="kn">from</span> <span class="nn">scanfrequency</span> <span class="kn">import</span> <span class="n">scan_frequency</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">QApplication</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>

<span class="c"># Load the UI from the QtDesigner file. You can also use pyuic4 to generate a class.</span>
<span class="n">main</span> <span class="o">=</span> <span class="n">loadUi</span><span class="p">(</span><span class="s">&#39;scanfrequency.ui&#39;</span><span class="p">)</span>

<span class="n">Hz</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;Hz&#39;</span><span class="p">)</span>
<span class="n">sec</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;second&#39;</span><span class="p">)</span>

<span class="k">with</span> <span class="n">LantzSignalGeneratorTCP</span><span class="p">(</span><span class="s">&#39;localhost&#39;</span><span class="p">,</span> <span class="mi">5678</span><span class="p">)</span> <span class="k">as</span> <span class="n">inst</span><span class="p">:</span>

    <span class="c"># Obtain a reference to the widgets controlling the scan parameters</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">main</span><span class="o">.</span><span class="n">findChild</span><span class="p">((</span><span class="n">QWidget</span><span class="p">,</span> <span class="p">),</span> <span class="s">&#39;start&#39;</span><span class="p">)</span>
    <span class="n">stop</span> <span class="o">=</span> <span class="n">main</span><span class="o">.</span><span class="n">findChild</span><span class="p">((</span><span class="n">QWidget</span><span class="p">,</span> <span class="p">),</span> <span class="s">&#39;stop&#39;</span><span class="p">)</span>
    <span class="n">step</span> <span class="o">=</span> <span class="n">main</span><span class="o">.</span><span class="n">findChild</span><span class="p">((</span><span class="n">QWidget</span><span class="p">,</span> <span class="p">),</span> <span class="s">&#39;step&#39;</span><span class="p">)</span>
    <span class="n">wait</span> <span class="o">=</span> <span class="n">main</span><span class="o">.</span><span class="n">findChild</span><span class="p">((</span><span class="n">QWidget</span><span class="p">,</span> <span class="p">),</span> <span class="s">&#39;wait&#39;</span><span class="p">)</span>
    <span class="n">scan</span> <span class="o">=</span> <span class="n">main</span><span class="o">.</span><span class="n">findChild</span><span class="p">((</span><span class="n">QWidget</span><span class="p">,</span> <span class="p">),</span> <span class="s">&#39;scan&#39;</span><span class="p">)</span>

    <span class="c"># &lt;--------- This is new ---------&gt;</span>
    <span class="n">connect_driver</span><span class="p">(</span><span class="n">main</span><span class="p">,</span> <span class="n">inst</span><span class="p">)</span>

    <span class="n">progress</span> <span class="o">=</span> <span class="n">main</span><span class="o">.</span><span class="n">findChild</span><span class="p">((</span><span class="n">QWidget</span><span class="p">,</span> <span class="p">),</span> <span class="s">&#39;progress&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_progress_bar</span><span class="p">(</span><span class="n">new</span><span class="p">,</span> <span class="n">old</span><span class="p">):</span>
        <span class="n">fraction</span> <span class="o">=</span> <span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">magnitude</span> <span class="o">-</span> <span class="n">start</span><span class="o">.</span><span class="n">value</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="n">stop</span><span class="o">.</span><span class="n">value</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>
        <span class="n">progress</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">fraction</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>

    <span class="n">inst</span><span class="o">.</span><span class="n">frequency_changed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">update_progress_bar</span><span class="p">)</span>


    <span class="c"># Define a function to read the values from the widget and call scan_frequency</span>
    <span class="k">def</span> <span class="nf">scan_clicked</span><span class="p">():</span>
        <span class="n">scan_frequency</span><span class="p">(</span><span class="n">inst</span><span class="p">,</span> <span class="n">start</span><span class="o">.</span><span class="n">value</span><span class="p">()</span> <span class="o">*</span> <span class="n">Hz</span><span class="p">,</span> <span class="n">stop</span><span class="o">.</span><span class="n">value</span><span class="p">()</span> <span class="o">*</span> <span class="n">Hz</span><span class="p">,</span>
                       <span class="n">step</span><span class="o">.</span><span class="n">value</span><span class="p">()</span> <span class="o">*</span> <span class="n">Hz</span><span class="p">,</span> <span class="n">wait</span><span class="o">.</span><span class="n">value</span><span class="p">()</span> <span class="o">*</span> <span class="n">sec</span><span class="p">)</span>

    <span class="c"># Connect the clicked signal of the scan button to the function</span>
    <span class="n">scan</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">scan_clicked</span><span class="p">)</span>

    <span class="c"># Scan the app</span>
    <span class="n">main</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="nb">exit</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">exec_</span><span class="p">())</span>
</pre></div>
</div>
<p>The function <cite>connect_driver</cite> matches by name Widgets to Feats and then connects
them. Under the hood, for each match it:</p>
<blockquote>
<div><p>1.- Wraps the widget to make it Lantz compatible.</p>
<p>2.- If applicable, configures minimum, maximum, steps and units.</p>
<p>3.- Add a handler such as when the widget value is changed, the Feat is updated.</p>
<p>4.- Add a handler such as when the Feat value is changed, the widget is updated.</p>
</div></blockquote>
<p>You can learn more and some alternatives in <a class="reference internal" href="../guides/ui-driver.html#ui-driver"><em>Connecting a custom UI to a driver</em></a>.</p>
<p>To update the progress bar, we connected the <cite>frequency_changed</cite> signal to a
function that updates the progress bar.</p>
<p>Run this example and test how you can change the amplitude, offset and waveform:</p>
<div class="highlight-python"><pre>$ python scanfrequency-gui.py</pre>
</div>
<p>However, you will see that the frequency and the progress bar are not updated
during the scan.</p>
</div>
<div class="section" id="using-a-background-thread">
<h2>6.2. Using a background thread<a class="headerlink" href="#using-a-background-thread" title="Permalink to this headline">Â¶</a></h2>
<p>The drawback of the previous (simple) approach is that the scan is executed in the same
thread as the GUI, effectively locking the main window and making the application
unresponsive. Qt Multithreading programming is out of the scope of this tutorial
(checkout <a href="#id1"><span class="problematic" id="id2">`Threads in Qt`_</span></a> for more info), but we will provide some examples
how to do it:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">sys</span>

<span class="c"># Import lantz.ui register an import hook that will replace calls to Qt by PyQt4 or PySide ...</span>
<span class="kn">import</span> <span class="nn">lantz.ui</span>
<span class="kn">from</span> <span class="nn">lantz</span> <span class="kn">import</span> <span class="n">Q_</span>

<span class="c"># Import from lantz a function to connect drivers to UI</span>
<span class="kn">from</span> <span class="nn">lantz.ui.qtwidgets</span> <span class="kn">import</span> <span class="n">connect_driver</span>

<span class="c"># and here we just use Qt and will work with both bindings!</span>
<span class="kn">from</span> <span class="nn">Qt.QtGui</span> <span class="kn">import</span> <span class="n">QApplication</span><span class="p">,</span> <span class="n">QWidget</span>
<span class="kn">from</span> <span class="nn">Qt.uic</span> <span class="kn">import</span> <span class="n">loadUi</span>

<span class="c"># We import</span>
<span class="kn">from</span> <span class="nn">Qt.QtCore</span> <span class="kn">import</span> <span class="n">QThread</span><span class="p">,</span> <span class="n">QObject</span>

<span class="c"># These imports are from your own project</span>
<span class="kn">from</span> <span class="nn">mydriver</span> <span class="kn">import</span> <span class="n">LantzSignalGeneratorTCP</span>
<span class="kn">from</span> <span class="nn">scanfrequency</span> <span class="kn">import</span> <span class="n">scan_frequency</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">QApplication</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>

<span class="c"># Load the UI from the QtDesigner file. You can also use pyuic4 to generate a class.</span>
<span class="n">main</span> <span class="o">=</span> <span class="n">loadUi</span><span class="p">(</span><span class="s">&#39;scanfrequency.ui&#39;</span><span class="p">)</span>

<span class="n">Hz</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;Hz&#39;</span><span class="p">)</span>
<span class="n">sec</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;second&#39;</span><span class="p">)</span>

<span class="k">with</span> <span class="n">LantzSignalGeneratorTCP</span><span class="p">(</span><span class="s">&#39;localhost&#39;</span><span class="p">,</span> <span class="mi">5678</span><span class="p">)</span> <span class="k">as</span> <span class="n">inst</span><span class="p">:</span>

    <span class="c"># Connect the main panel widgets to the instruments Feats,</span>
    <span class="c"># matching by name</span>
    <span class="n">connect_driver</span><span class="p">(</span><span class="n">main</span><span class="p">,</span> <span class="n">inst</span><span class="p">)</span>

    <span class="c"># Obtain a reference to the widgets controlling the scan parameters</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">main</span><span class="o">.</span><span class="n">findChild</span><span class="p">((</span><span class="n">QWidget</span><span class="p">,</span> <span class="p">),</span> <span class="s">&#39;start&#39;</span><span class="p">)</span>
    <span class="n">stop</span> <span class="o">=</span> <span class="n">main</span><span class="o">.</span><span class="n">findChild</span><span class="p">((</span><span class="n">QWidget</span><span class="p">,</span> <span class="p">),</span> <span class="s">&#39;stop&#39;</span><span class="p">)</span>
    <span class="n">step</span> <span class="o">=</span> <span class="n">main</span><span class="o">.</span><span class="n">findChild</span><span class="p">((</span><span class="n">QWidget</span><span class="p">,</span> <span class="p">),</span> <span class="s">&#39;step&#39;</span><span class="p">)</span>
    <span class="n">wait</span> <span class="o">=</span> <span class="n">main</span><span class="o">.</span><span class="n">findChild</span><span class="p">((</span><span class="n">QWidget</span><span class="p">,</span> <span class="p">),</span> <span class="s">&#39;wait&#39;</span><span class="p">)</span>
    <span class="n">scan</span> <span class="o">=</span> <span class="n">main</span><span class="o">.</span><span class="n">findChild</span><span class="p">((</span><span class="n">QWidget</span><span class="p">,</span> <span class="p">),</span> <span class="s">&#39;scan&#39;</span><span class="p">)</span>
    <span class="n">progress</span> <span class="o">=</span> <span class="n">main</span><span class="o">.</span><span class="n">findChild</span><span class="p">((</span><span class="n">QWidget</span><span class="p">,</span> <span class="p">),</span> <span class="s">&#39;progress&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_progress_bar</span><span class="p">(</span><span class="n">new</span><span class="p">,</span> <span class="n">old</span><span class="p">):</span>
        <span class="n">fraction</span> <span class="o">=</span> <span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">magnitude</span> <span class="o">-</span> <span class="n">start</span><span class="o">.</span><span class="n">value</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="n">stop</span><span class="o">.</span><span class="n">value</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>
        <span class="n">progress</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">fraction</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>

    <span class="n">inst</span><span class="o">.</span><span class="n">frequency_changed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">update_progress_bar</span><span class="p">)</span>

    <span class="c"># &lt;--------- New code---------&gt;</span>
    <span class="c"># Define a function to read the values from the widget and call scan_frequency</span>
    <span class="k">class</span> <span class="nc">Scanner</span><span class="p">(</span><span class="n">QObject</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">scan</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="c"># Call the scan frequency</span>
            <span class="n">scan_frequency</span><span class="p">(</span><span class="n">inst</span><span class="p">,</span> <span class="n">start</span><span class="o">.</span><span class="n">value</span><span class="p">()</span> <span class="o">*</span> <span class="n">Hz</span><span class="p">,</span> <span class="n">stop</span><span class="o">.</span><span class="n">value</span><span class="p">()</span> <span class="o">*</span> <span class="n">Hz</span><span class="p">,</span>
                           <span class="n">step</span><span class="o">.</span><span class="n">value</span><span class="p">()</span> <span class="o">*</span> <span class="n">Hz</span><span class="p">,</span> <span class="n">wait</span><span class="o">.</span><span class="n">value</span><span class="p">()</span> <span class="o">*</span> <span class="n">sec</span><span class="p">)</span>
            <span class="c"># When it finishes, set the progress to 100%</span>
            <span class="n">progress</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

    <span class="n">thread</span> <span class="o">=</span> <span class="n">QThread</span><span class="p">()</span>
    <span class="n">scanner</span> <span class="o">=</span> <span class="n">Scanner</span><span class="p">()</span>
    <span class="n">scanner</span><span class="o">.</span><span class="n">moveToThread</span><span class="p">(</span><span class="n">thread</span><span class="p">)</span>
    <span class="n">thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="c"># Connect the clicked signal of the scan button to the function</span>
    <span class="n">scan</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">scanner</span><span class="o">.</span><span class="n">scan</span><span class="p">)</span>

    <span class="n">app</span><span class="o">.</span><span class="n">aboutToQuit</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">thread</span><span class="o">.</span><span class="n">quit</span><span class="p">)</span>
    <span class="c"># &lt;--------- End of new code ---------&gt;</span>

    <span class="n">main</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="nb">exit</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">exec_</span><span class="p">())</span>
</pre></div>
</div>
<p>In Qt, when a signal is connected to a slot (a function of a QObject),
the execution occurs in the Thread of the receiver (not the emitter).
That is why we moved the QObject to the new thread.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">On a production app it would be good to add a lock to prevent the application
from exiting or calling the scanner while a scanning is running.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper"><p><a href="../index.html">
  <img src="../_images/lantz_logo.png" alt="Logo" style="width:80%;height:80%"/>
</a></p>

  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">6. A simple GUI app</a><ul>
<li><a class="reference internal" href="#connecting-widgets-to-feats">6.1. Connecting widgets to Feats</a></li>
<li><a class="reference internal" href="#using-a-background-thread">6.2. Using a background thread</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="cli-app.html"
                        title="previous chapter">5. A simple command line app</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../guides/index.html"
                        title="next chapter">Guides</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/tutorial/gui-app.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../guides/index.html" title="Guides"
             >next</a> |</li>
        <li class="right" >
          <a href="cli-app.html" title="5. A simple command line app"
             >previous</a> |</li>
        <li><img src="../_static/lantz16.png" alt=""
                 style="vertical-align: middle; margin-top: -1px"/></li>
        <li><a href="../index.html">Lantz</a> &raquo;</li>

          <li><a href="index.html" >Tutorials</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
    &copy; Copyright 2012, Lantz Authors.
    <br />
    Last updated on Dec 31, 2012.
    <a href="../bugs.html">Found a bug</a>?
    <br />
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.2.
    </div>

  </body>
</html>